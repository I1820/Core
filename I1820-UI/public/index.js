var app=new Vue({el:"#app",data:{rpis:{},endpoint:"",states:{},things:[]},created:function(){this.refresh(),$("time.timeago").timeago()},updated:function(){$("time.timeago").timeago()},watch:{endpoint:function(){"string"==typeof this.endpoint&&(this.things=this.rpis[this.endpoint].things)}},methods:{refresh:function(){$.get("discovery",function(t,e){app.rpis=JSON.parse(t)})},drawCurrent:function(t){var e=180-t,i=.5,n=e*Math.PI/180,a=i*Math.cos(n),o=i*Math.sin(n),r="M -.0 -0.025 L .0 0.025 L ",s=String(a),p=" ",h=String(o),g=" Z",c=r.concat(s,p,h,g),l={shapes:[{type:"path",path:c,fillcolor:"850000",line:{color:"850000"}}],title:"Current Gauge",height:300,width:300,xaxis:{zeroline:!1,showticklabels:!1,showgrid:!1,range:[-1,1]},yaxis:{zeroline:!1,showticklabels:!1,showgrid:!1,range:[-1,1]}},d=[{type:"scatter",x:[0],y:[0],marker:{size:20,color:"850000"},showlegend:!1,name:"A",text:t,hoverinfo:"text+name"},{values:[50/6,50/6,50/6,50/6,50/6,50/6,50],rotation:90,text:["","","","","","",""],textinfo:"text",textposition:"inside",marker:{colors:["rgba(14, 127, 0, .5)","rgba(110, 154, 22, .5)","rgba(170, 202, 42, .5)","rgba(202, 209, 95, .5)","rgba(210, 206, 145, .5)","rgba(232, 226, 202, .5)","rgba(255, 255, 255, 0)"]},labels:["151-180","121-150","91-120","61-90","31-60","0-30",""],hoverinfo:"label",hole:.5,type:"pie",showlegend:!1}];Plotly.newPlot("current",d,l)},fetch:function(t,e,i){var n={type:t,rpi_id:this.endpoint,device_id:i,states:e};$.post("thing",JSON.stringify(n),function(t,e){var i=JSON.parse(t);for(var n in i)i.hasOwnProperty(n)&&(i[n].time=new Date(i[n].time).toLocaleString(),Vue.set(app.states,n,i[n]))})},turn:function(t,e){var i={type:"lamp",rpi_id:this.endpoint,device_id:e,settings:{on:t}};$.ajax({url:"thing",type:"PUT",contentType:"application/json",data:JSON.stringify(i)})}}});$("document").ready(function(){});